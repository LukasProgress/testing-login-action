name: Login to ECR

on:
  workflow_dispatch:

# Required for OIDC authentication
permissions:
  id-token: write
  contents: read

jobs:
  ecr-login:
    runs-on: ubuntu-latest
    
    steps:
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          audience: sts.amazonaws.com
          role-to-assume: arn:aws-eusc:iam::${{ secrets.AWS_ACCOUNT_ID }}:role/${{ vars.AWS_ROLE_NAME }}
          aws-region: ${{ vars.AWS_REGION }}
      
      - name: Login to AWS Container Registry
        uses: dphi/login-action@add-support-for-amazonaws.eu
        with:
          registry: ${{ secrets.AWS_ACCOUNT_ID }}.dkr.ecr.${{ vars.AWS_REGION }}.amazonaws.eu
          ecr: true
        env:
          AWS_REGION: ${{ vars.AWS_REGION }}
      
      - name: Verify Login
        run: |
          echo "âœ… Successfully logged in to ECR"
          echo "Registry: ${{ secrets.AWS_ACCOUNT_ID }}.dkr.ecr.${{ vars.AWS_REGION }}.amazonaws.eu"
